<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="Behavior in a consistent region"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="spldoc_page"/>
<link rel="stylesheet" type="text/css" href="../../html/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../html/spldoc.css"/>
<title>Behavior in a consistent region</title>
</head>
<body id="spldoc_page">


<h1 class="title topictitle1">Behavior in a consistent region</h1>

<div class="body refbody">
<div class="section">
<p class="p">
<a class="xref" href="../toolkits/toolkits.html">IBMStreams com.ibm.streamsx.objectstorage Toolkit</a> &gt; <a class="xref" href="tk$com.ibm.streamsx.objectstorage.html">com.ibm.streamsx.objectstorage 1.7.5</a> &gt; <a class="xref" href="ns$com.ibm.streamsx.objectstorage.html">com.ibm.streamsx.objectstorage</a> &gt; <a class="xref" href="op$com.ibm.streamsx.objectstorage$ObjectStorageSink.html">ObjectStorageSink</a> &gt; Behavior in a consistent region</p>

</div>


<div class="section">
<p class="p">The operator can participate in a consistent region. The operator can be part of a consistent region, but cannot be at the start of a consistent region.
</p>

<p class="p">While consistent region supports that tuples are processed at least once, the operator creates objects in object storage with exactly once semantics.
</p>

<div class="p">Failures during tuple processing or drain are handled by the operator and consistent region support:
<ul class="ul">
<li class="li"> Object is not visible before it is finally closed</li>

<li class="li"> Consistent region replays tuples in case of failures</li>

<li class="li"> Object with the same name is overwritten on object storage</li>

</ul>

</div>

<p class="p"><br/><img class="image" src="../../image/copy/1$Sink_CRSupport.png" alt=""/><br/>
</p>

<p class="p">On drain, the operator flushes its internal buffer and uploads the object to the object storage. On checkpoint, the operator stores the current object number to the checkpoint. If the region became inconsistent (e.g. failure causes PE restart), then <tt class="ph tt">reset()</tt> is called and the operator reads the checkpointed data. In the case the region is resetted after objects have been already closed on object storage, the affected objects are deleted on object storage.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Restrictions
</h2>

<p class="p">The close mode can not be configured when running in a consistent region. The parameters <tt class="ph tt">bytesPerObject</tt>, <tt class="ph tt">closeOnPunct</tt>, <tt class="ph tt">timePerObject</tt> and <tt class="ph tt">tuplesPerObject</tt> are ignored.
</p>

<p class="p">There is a limited set of variables for the object name supported when running consistent region. The variable <tt class="ph tt">%OBJECTNUM</tt> is mandatory, <tt class="ph tt">%PARTITIONS</tt> is optional, all other variables are not supported. The object number is incrementend after objects are uploaded at end of drain.
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Metrics
</h2>

<div class="p">The following metrics are available when operator is part of a consistent region only:
<ul class="ul">
<li class="li"> <strong class="ph b"><tt class="ph tt">drainTime</tt></strong> - Drain time of this operator in milliseconds</li>

<li class="li"> <strong class="ph b"><tt class="ph tt">drainTimeMax</tt></strong> - Maximum drain time of this operator in milliseconds</li>

<li class="li"> <strong class="ph b"><tt class="ph tt">processingRate</tt></strong> - Number of input data processed in KB/sec.</li>

<li class="li"> <strong class="ph b"><tt class="ph tt">nDeletedObjects</tt></strong> - Number of objects deleted on reset after objects are closed.</li>

</ul>

</div>

<p class="p">The metric <strong class="ph b"><tt class="ph tt">processingRate</tt></strong> is calculated by the number of bytes received until <tt class="ph tt">drain()</tt> and the time from first tuple arrival until end of <tt class="ph tt">checkpoint()</tt>
</p>

<p class="p"><br/><img class="image" src="../../image/copy/1$processingTime.png" alt=""/><br/>
</p>

</div>

</div>


</body>
</html>