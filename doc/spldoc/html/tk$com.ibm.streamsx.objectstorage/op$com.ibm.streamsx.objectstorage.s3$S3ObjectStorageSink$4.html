<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="Rolling Policy"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="spldoc_page"/>
<link rel="stylesheet" type="text/css" href="../../html/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../html/spldoc.css"/>
<title>Rolling Policy</title>
</head>
<body id="spldoc_page">


<h1 class="title topictitle1">Rolling Policy</h1>

<div class="body refbody">
<div class="section">
<p class="p">
<a class="xref" href="../toolkits/toolkits.html">IBMStreams com.ibm.streamsx.objectstorage Toolkit</a> &gt; <a class="xref" href="tk$com.ibm.streamsx.objectstorage.html">com.ibm.streamsx.objectstorage 2.1.3</a> &gt; <a class="xref" href="ns$com.ibm.streamsx.objectstorage.s3.html">com.ibm.streamsx.objectstorage.s3</a> &gt; <a class="xref" href="op$com.ibm.streamsx.objectstorage.s3$S3ObjectStorageSink.html">S3ObjectStorageSink</a> &gt; Rolling Policy</p>

</div>


<div class="section">
<p class="p">Rolling policy specifies the window size managed by operator per output object. When window is closed the current output object is closed and a new object is opened. The operator supports three rolling policy types:
</p>

<div class="p">
<ul class="ul">
<li class="li"> Size-based (parameter <tt class="ph tt">bytesPerObject</tt>)</li>

<li class="li">
<p class="p"> Time-based (parameter <tt class="ph tt">timePerObject</tt>)
</p>
</li>

<li class="li">
<p class="p"> Tuple count-based (parameter <tt class="ph tt">tuplesPerObject</tt>)
</p>
</li>

</ul>

</div>

</div>

<div class="section"><h2 class="title sectiontitle">Object name
</h2>

<p class="p">The <tt class="ph tt">objectName</tt> parameter can optionally contain the following variables, which the operator evaluates at runtime to generate the object name:
</p>

<p class="p"><strong class="ph b">%TIME</strong> is the time when the COS object is created. The default time format is yyyyMMdd_HHmmss.
</p>

<p class="p">The variable %TIME can be added anywhere in the path after the bucket name. The variable is typically used to make dynamic object names when you expect the application to create multiple objects.
</p>

<p class="p">Here are some examples of valid file paths with %TIME:
</p>

<div class="p">
<ul class="ul">
<li class="li"> <tt class="ph tt">event%TIME.parquet</tt></li>

<li class="li">
<p class="p"> <tt class="ph tt">%TIME_event.parquet</tt>
</p>
</li>

<li class="li">
<p class="p"> <tt class="ph tt">/my_new_folder/my_new_file_%TIME.csv</tt>
</p>
</li>

</ul>

</div>

<p class="p"><strong class="ph b">%OBJECTNUM</strong> is an object number, starting at 0, when a new object is created for writing.
</p>

<p class="p">Objects with the same name will be overwritten. Typically, %OBJECTNUM is added after the file name.
</p>

<p class="p">Here are some examples of valid file paths with %OBJECTNUM:
</p>

<div class="p">
<ul class="ul">
<li class="li"> <tt class="ph tt">event_%OBJECTNUM.parquet</tt></li>

<li class="li">
<p class="p"> <tt class="ph tt">/geo/uk/geo_%OBJECTNUM.parquet</tt>
</p>
</li>

<li class="li">
<p class="p"> <tt class="ph tt">%OBJECTNUM_event.csv</tt>
</p>
</li>

<li class="li">
<p class="p"> <tt class="ph tt">%OBJECTNUM_%TIME.csv</tt>
</p>
</li>

</ul>

</div>

<p class="p">Note: If partitioning is used, %OBJECTNUM is managed globally for all partitions in the COS object,rather than independently for each partition.
</p>

<p class="p"><strong class="ph b">%PARTITIONS</strong> place partitions anywhere in the object name.  By default, partitions are placed immediately before the last part of the object name.
</p>

<p class="p">Here's an example of default position of partitions in an object name: 
</p>

<p class="p">Suppose that the file path is <tt class="ph tt">/GeoData/test_%TIME.parquet</tt>. Partitions are defined as YEAR, MONTH, DAY, and HOUR.
</p>

<p class="p">The object in COS would be <tt class="ph tt">/GeoData/YEAR=2014/MONTH=7/DAY=29/HOUR=36/test_20171022_124948.parquet</tt> 
</p>

<p class="p">With %PARTITIONS, you can change the placement of partitions in the object name from the default. 
</p>

<p class="p">Let's see how the partition placement changes by using %PARTITIONS:
</p>

<p class="p">Suppose that the file path now is <tt class="ph tt">/GeoData/Asia/%PARTITIONS/test_%TIME.parquet.</tt> 
</p>

<p class="p">The object name in COS would be <tt class="ph tt">/GeoData/Asia/YEAR=2014/MONTH=7/DAY=29/HOUR=36/test_20171022_124948.parquet</tt>
</p>

<p class="p"><strong class="ph b">Empty partition values</strong> 
</p>

<p class="p">If a value in a partition is not valid, the invalid values are replaced by the string <tt class="ph tt">__HIVE_DEFAULT_PARTITION__</tt> in the COS object name.
</p>

<p class="p">For example, <tt class="ph tt">/GeoData/Asia/YEAR=2014/MONTH=7/DAY=29/HOUR=__HIVE_DEFAULT_PARTITION__/test_20171022_124948.parquet</tt>
</p>

<p class="p"><strong class="ph b">Further variables for the object name</strong>
</p>

<div class="p">
<ul class="ul">
<li class="li"> <tt class="ph tt">%HOST</tt> the host that is running the processing element (PE) of this operator.</li>

<li class="li">
<p class="p"> <tt class="ph tt">%PROCID</tt> the process ID of the processing element running the this operator.
</p>
</li>

<li class="li">
<p class="p"> <tt class="ph tt">%PEID</tt> the processing element ID.
</p>
</li>

<li class="li">
<p class="p"> <tt class="ph tt">%PELAUNCHNUM</tt> the PE launch count.
</p>
</li>

<li class="li">
<p class="p"> <tt class="ph tt">%CHANNEL</tt> the channel number of the operator (0..n). If not part of parallel region, then the variable is replaced with 0.
</p>
</li>

</ul>

</div>

</div>

</div>


</body>
</html>